# Google Sheets シート名変更 - 実装完了報告書

## 📌 実装内容

### ✅ 完了した修正

#### 1. Google Sheets の構成変更

| 項目 | 旧 | 新 | 説明 |
|---|---|---|---|
| **シート1** | シート1 | `記事一覧` | 生成された記事を管理 |
| **シート2** | シート2 | `記事テーマ` | 記事生成の入力データ |
| **シート3** | （なし） | `アフィリエイト管理` | 商品ごとのリンク管理（新規） |

#### 2. コード修正

✅ **修正完了:**
- `automation/content/article_generator_html.py` - シート名を `'記事テーマ'` に更新
- `automation/content/article_generator_v2.py` - シート名を `'記事テーマ'` に更新
- `automation/scripts/setup_article_sheet.py` - シート名を `'記事テーマ'` に更新

✅ **ドキュメント更新:**
- `docs/article/ARTICLE_CREATION_SPECIFICATION.md` - シート構成を反映
- `docs/article/ARTICLE_GOOGLESHEETS_STRUCTURE.md` - 新規作成（詳細ドキュメント）
- `docs/article/GOOGLESHEETS_MIGRATION_GUIDE.md` - 新規作成（移行ガイド）

#### 3. その他スクリプトの状態

**以下のスクリプトは `シート1` を参照していますが、用途が異なるため現時点では修正不要：**

- `automation/social_media/` 配下：
  - `article_detector_v2.py` - 記事検出用
  - `approval_manager.py` - 承認管理用
  - `approve_tweet.py` - ツイート投稿用
  
- `automation/content/` 配下：
  - `article_generator.py` - 旧版（v2推奨）
  - `wordpress_publisher.py` - 記事投稿用
  - `github_article_publisher.py` - GitHub連携用

**判断:** これらは「ツイート承認キュー」用のシート1を参照しており、「記事一覧」シートとは用途が異なる可能性あり。整理が必要な場合は別途実装。

---

## 📊 シート構成の新規詳細

### シート1: 記事一覧

```
タイムスタンプ | ステータス | 記事タイトル | 記事ID | 公開URL | 記事の分類 | ターゲット | ...
2026-01-17 | 投稿済み | 【決定版】Naturecan... | 1174 | https://... | 商品紹介 | CBD初心者 | ...
```

### シート2: 記事テーマ

```
タイムスタンプ | ステータス | 記事テーマ | 記事の分類 | ターゲット | タグ | ...
（自動） | 新規 | Naturecan(ネイチャーカン)について | 商品紹介 | CBD初心者 | CBD,初心者,おすすめ | ...
```

### シート3: アフィリエイト管理（新規）

```
商品ID | 商品名 | ブランド | カテゴリ | 価格 | 総CBD量 | 1mg単価 | アフィリエイトURL | ...
prod_001 | Naturecan CBDオイル 10% | Naturecan | CBDオイル | 8000 | 1000 | 8.0 | https://px.a8.net/... | ...
```

**重要:** 記事とアフィリエイト商品の紐付け
- シート2の「I列（使用アフィリエイト）」で商品IDを指定
- 記事生成時に自動でシート3のK列（使用記事ID）に反映

---

## 🛠️ ユーザー対応（手動作業）

### 1. Google Sheets のシート名を変更

**手順:**

1. Google Sheets を開く: https://docs.google.com/spreadsheets/d/1-2L6C3NpF8vqnXxHWKP-Js3TMFKYE73tTtxdkZVPTaM/

2. **シート1** タブを右クリック
   - 「名前を変更」を選択
   - `記事一覧` に変更

3. **シート2** タブを右クリック
   - 「名前を変更」を選択
   - `記事テーマ` に変更

4. 右下の **「+」ボタン** をクリック
   - 新しいシートを追加
   - タブ名を `アフィリエイト管理` に変更

### 2. シート3（アフィリエイト管理）にヘッダーを設定

**A1～P1 に以下を入力:**

```
商品ID
商品名
ブランド
カテゴリ
価格
総CBD量
1mg単価
アフィリエイトURL
ボタンテキスト
商品画像URL
使用記事ID
使用記事タイトル
使用記事数
CV数（月）
経由売上（月）
備考
```

### 3. 既存アフィリエイトリンクを統合

**参考:** https://docs.google.com/spreadsheets/d/1vRrHmqF04QPhpuZY0wdFO8vvwj4AIBatHGEZ5zVBi7g/

- 既存の商品情報をコピー
- 新シート3に貼り付け
- 商品ID（prod_001等）を付与

---

## 🔄 記事生成フロー（更新版）

```
【毎朝8:00】

1. シート2（記事テーマ）から新規行を読込
   ├─ ステータス: 新規
   ├─ 記事テーマ: 例「Naturecan（ネイチャーカン）について」
   ├─ 記事の分類: 10種類から選択
   └─ 使用アフィリエイト: prod_001 等を指定（オプション）

2. Gemini APIでHTML記事を生成
   ├─ テンプレート選択（分類に応じて）
   └─ 10テンプレートから最適化

3. WordPressに下書き投稿
   └─ 記事ID を取得

4. スプレッドシートに自動反映
   ├─ シート1（記事一覧）に自動追記
   │  └─ D列: 記事ID
   │  └─ K列: 使用アフィリエイト
   │
   └─ シート3（アフィリエイト管理）を更新
      └─ K列（使用記事ID）に記事IDを追記
      └─ L列（使用記事タイトル）を更新
      └─ M列（使用記事数）を再計算

5. LINE通知でプレビュー送信

6. ユーザーが WordPress で確認・編集

7. スプレッドシート（シート2）で「承認済み」に変更

【13時、18時、21時】

8. 承認済み記事を検出・投稿
   └─ ステータスを「投稿済み」に更新
```

---

## ✅ 実装チェックリスト

### Google Sheets 側

- [ ] シート1 を `記事一覧` に名前変更
- [ ] シート2 を `記事テーマ` に名前変更
- [ ] シート3 を作成して `アフィリエイト管理` に命名
- [ ] シート3 にヘッダー行を設定（A1～P1）
- [ ] 既存アフィリエイトリンクをシート3に統合
- [ ] シート2 のサンプル行を更新

### コード側

✅ **完了:**
- `article_generator_html.py` - シート名更新
- `article_generator_v2.py` - シート名更新
- `setup_article_sheet.py` - シート名更新
- `ARTICLE_CREATION_SPECIFICATION.md` - ドキュメント更新

### テスト

- [ ] 新しい記事テーマを シート2 に入力
- [ ] 毎朝8:00に自動生成されるか確認
- [ ] シート1に自動追記されるか確認
- [ ] シート3の「使用記事ID」が更新されるか確認
- [ ] LINE通知で正常にプレビューが送信されるか確認

---

## 📝 重要な注意事項

### 1. シート名の完全一致

- Google Sheets のシート名は **大文字小文字を区別しません**
- しかし Python の `read_spreadsheet` では **完全一致** で処理
- **必ず以下の名前に変更:**
  - ✅ `記事一覧` （半角スペース無し）
  - ✅ `記事テーマ` （半角スペース無し）
  - ✅ `アフィリエイト管理` （半角スペース無し）

### 2. 旧シートのバックアップ

- 旧「シート1」「シート2」のデータは削除しない
- 必要に応じてバックアップを作成

### 3. 複数の「シート1」参照について

- ツイート承認用の「シート1」と記事一覧の「シート1」は異なる用途
- 現在、ツイート関連スクリプトは旧「シート1」を参照
- 将来的に整理が必要な場合は別途対応

---

## 📚 参考ドキュメント

1. **`ARTICLE_GOOGLESHEETS_STRUCTURE.md`**
   - 各シートの詳細構成
   - カラム定義
   - データ入力例

2. **`GOOGLESHEETS_MIGRATION_GUIDE.md`**
   - 移行手順
   - コード修正リスト
   - テスト方法

3. **`ARTICLE_CREATION_SPECIFICATION.md`**
   - 記事作成要件
   - HTML仕様
   - チェックリスト

4. **`ARTICLE_TEMPLATES_PROPOSAL_PART2.md`**
   - 10種類のテンプレート
   - 各テンプレートの詳細

---

## 🎯 次のステップ

### Phase 1: 基本設定（今すぐ）
1. Google Sheets でシート名を変更
2. シート3 にヘッダーを設定
3. 既存アフィリエイト情報を統合

### Phase 2: テスト（明日以降）
1. テスト記事テーマを シート2 に入力
2. 自動生成が正常に動作するか確認
3. シート間の連携が機能するか確認

### Phase 3: 本格運用（確認後）
1. 毎日の記事テーマ登録を開始
2. アフィリエイト成績を月次で追跡
3. 成績の良い商品を優先的に選択

---

**実装日:** 2026-01-17  
**ステータス:** ✅ コード修正完了、⏳ Google Sheets 手動変更待ち  
**対象:** CBD自動記事生成システム
