# ConoHa WING REST-API 403エラー 解決方法

## 📋 問題の原因

- ✅ `.htaccess`ファイルにREST APIをブロックするルールはない
- ✅ ConoHa WINGのREST-API設定は「利用」（有効）
- ❌ GitHub Actionsから403エラー

**原因:** ConoHa WINGの「海外アクセス制限」の「REST-API」が「利用」（有効）になっているため、海外からのREST-APIアクセスがブロックされています。

GitHub Actionsは海外のサーバー（米国など）で実行されるため、この設定によってアクセスが拒否されています。

---

## 🔧 解決方法

### 方法1: 「海外アクセス制限」の「REST-API」を無効化（推奨）

**注意:** この設定を無効化すると、海外からのREST-APIアクセスが許可されます。セキュリティ上の考慮が必要です。

**手順:**
1. WordPress管理画面にログイン
2. 左メニューから **「ConoHa WING」** → **「WordPressセキュリティ設定」** を開く
3. **「海外アクセス制限」** セクションを探す
4. **「REST-API」** のチェックボックスを **外す**（無効化）
5. **「設定を更新する」** ボタンをクリック

---

### 方法2: アプリケーションパスワードを使用（既に実装済み）

現在、GitHub Actionsのスクリプトではアプリケーションパスワードを使用しています。これは正しいアプローチです。

しかし、ConoHa WINGの「海外アクセス制限」は認証の前段階でブロックするため、アプリケーションパスワードが正しくてもアクセスできません。

---

## ⚠️ セキュリティ上の考慮事項

「海外アクセス制限」の「REST-API」を無効化すると：

**メリット:**
- GitHub Actionsからのアクセスが可能になる
- 海外からのREST-APIアクセスが許可される

**デメリット:**
- 海外からのREST-APIアクセスが許可される（セキュリティリスク）
- ただし、アプリケーションパスワードによる認証は有効なまま

**推奨:**
- アプリケーションパスワードによる認証を維持することで、セキュリティを確保
- 「海外アクセス制限」を無効化しても、認証が必要なエンドポイントには影響しない

---

## 🎯 推奨手順

### Step 1: 「海外アクセス制限」の「REST-API」を無効化

1. WordPress管理画面 → **「ConoHa WING」** → **「WordPressセキュリティ設定」**
2. **「海外アクセス制限」** セクション → **「REST-API」** のチェックボックスを外す
3. **「設定を更新する」** ボタンをクリック

---

### Step 2: GitHub Actionsを再実行

1. GitHubリポジトリ → **Actions**タブ
2. **「Sync to WordPress」**ワークフローを選択
3. **「Run workflow」**ボタンをクリック
4. エラーが解消されたか確認

---

### Step 3: 確認

GitHub Actionsが成功し、WordPressに記事が同期されることを確認してください。

---

## 🔍 その他の確認事項

### アプリケーションパスワードの確認

現在、GitHub Secretsに以下の情報が設定されています：

- `WORDPRESS_URL`: https://cbd-no-hito.com
- `WORDPRESS_USERNAME`: yoshiki
- `WORDPRESS_APP_PASSWORD`: Zn5jnUxjfP0DQNgB6fCbaUYy

これらの情報が正しいことを確認してください。

---

## 📝 参考情報

- `docs/CONOHA_WING_REST_API_SETUP.md` - ConoHa WINGの設定ガイド
- `docs/WORDPRESS_403_NEXT_STEPS.md` - 次のステップのまとめ

---

## ⚠️ 注意事項

- 「海外アクセス制限」を無効化すると、海外からのREST-APIアクセスが許可されます
- ただし、アプリケーションパスワードによる認証は有効なままです
- セキュリティを確保するため、アプリケーションパスワードの管理を適切に行ってください
