# ワークフロー説明

## 📋 現在のワークフロー

### 毎朝7:00（自動実行）

**ツイート案生成スクリプト** (`scheduled_tweet.py`)

1. **記事タイトルとツイート文案を生成**
   - WordPressの新着記事を検知
   - または、CBDニュースを収集・要約
   - Gemini APIでツイート文案を生成

2. **LINE通知でプレビュー送信**
   - 生成したツイート文案をLINEで送信
   - あなたが確認できるように通知

3. **スプレッドシートに「下書き」として記録**
   - ステータス: 「下書き」
   - タイムスタンプ、記事タイトル、ツイート文案、URLなどを記録

---

### あなたが確認（午前中）

1. **LINEでプレビューを確認**
   - ツイート文案を確認
   - 内容が問題なければ、スプレッドシートで承認

2. **スプレッドシートで「承認済み」に変更**
   - B列（ステータス列）を「下書き」→「承認済み」に変更

---

### 毎日12:30（自動実行・変更予定）

**承認済みツイート投稿スクリプト** (`approve_tweet.py`)

1. **スプレッドシートから「承認済み」ツイートを読み込み**
   - ステータスが「承認済み」のツイートを取得

2. **X (Twitter)に投稿**
   - 承認済みツイートを1件ずつ投稿

3. **ステータスを「投稿済み」に更新**
   - 投稿完了後、ステータスを「承認済み」→「投稿済み」に変更

4. **LINE通知で投稿結果を送信**
   - 投稿成功・失敗をLINEで通知

---

## ❓ よくある質問

### Q1: 承認済みとなっている内容を出すんだよね？

**A:** はい、正しいです。

- **ステータス「承認済み」のツイート**を取得
- それらをX (Twitter)に投稿します

---

### Q2: 一度承認済みとなったものは何回もツイートされてしまう？

**A:** いいえ、何回もツイートされることはありません。

**理由:**
1. **投稿後、ステータスを「投稿済み」に更新**します
2. **次回の実行では「投稿済み」のツイートは無視**されます
3. **「承認済み」のツイートのみを投稿**します

**動作フロー:**
1. ステータス「承認済み」のツイートを取得
2. X (Twitter)に投稿
3. ステータスを「承認済み」→「投稿済み」に更新
4. 次回実行時、「投稿済み」のツイートは無視される

---

### Q3: 記事タイトルやツイート文案を考えるのはいつ？

**A:** 毎朝7:00に自動で生成されます。

**生成タイミング:**
- **毎朝7:00** - ツイート案生成スクリプトが自動実行
- WordPressの新着記事を検知
- または、CBDニュースを収集・要約
- Gemini APIでツイート文案を生成
- LINE通知でプレビュー送信
- スプレッドシートに「下書き」として記録

**あなたの対応:**
- 午前中にLINEでプレビューを確認
- スプレッドシートで「承認済み」に変更

---

### Q4: 昼過ぎにツイートして欲しい

**A:** 実行時刻を変更します。

**現在の設定:**
- ツイート案生成: 毎朝7:00
- ツイート投稿: 毎朝7:15

**変更後の設定（推奨）:**
- ツイート案生成: 毎朝7:00（変更なし）
- ツイート投稿: 毎日12:30（昼過ぎに変更）

**理由:**
- 午前中にあなたが確認できる時間を確保
- 昼過ぎ（12:30）に投稿することで、午前中に承認作業ができる

---

## 🔧 実行時刻の変更方法

### Launch Agentファイルを編集

1. **ファイルを編集:**
   ```bash
   nano ~/Library/LaunchAgents/com.cbd.auto-tweet.plist
   ```

2. **`Hour`と`Minute`を変更:**
   ```xml
   <key>Hour</key>
   <integer>12</integer>  <!-- 時（0-23） -->
   <key>Minute</key>
   <integer>30</integer>  <!-- 分（0-59） -->
   ```

3. **保存して終了:** Ctrl+X → Y → Enter

4. **Launch Agentを再読み込み:**
   ```bash
   launchctl bootout gui/$(id -u)/com.cbd.auto-tweet
   launchctl bootstrap gui/$(id -u) ~/Library/LaunchAgents/com.cbd.auto-tweet.plist
   ```

---

## 📊 ステータスの流れ

| ステータス | 説明 | 次回実行時の処理 |
|-----------|------|----------------|
| **下書き** | ツイート案が生成された状態 | 無視される |
| **承認済み** | あなたが承認した状態 | **投稿される** |
| **投稿済み** | 投稿が完了した状態 | 無視される |

---

## 🚀 推奨ワークフロー

### 毎朝7:00（自動実行）

1. **ツイート案生成**
2. **LINE通知でプレビュー送信**
3. **スプレッドシートに「下書き」として記録**

### 午前中（あなたの対応）

1. **LINEでプレビューを確認**
2. **スプレッドシートで「承認済み」に変更**

### 毎日12:30（自動実行・変更予定）

1. **承認済みツイートを自動投稿**
2. **ステータスを「投稿済み」に更新**
3. **LINE通知で投稿結果を送信**

---

## ✅ まとめ

### あなたの質問への回答

1. **承認済みとなっている内容を出すんだよね？**
   - ✅ はい、正しいです。「承認済み」のツイートを投稿します

2. **一度承認済みとなったものは何回もツイートされてしまう？**
   - ❌ いいえ、何回もツイートされることはありません
   - 投稿後、「投稿済み」に更新されるため、次回実行時は無視されます

3. **記事タイトルやツイート文案を考えるのはいつ？**
   - ✅ 毎朝7:00に自動で生成されます
   - Gemini APIでツイート文案を生成

4. **昼過ぎにツイートして欲しい**
   - ✅ 実行時刻を12:30に変更します

---

詳細は `docs/FINAL_SETUP_GUIDE.md` を参照してください。
