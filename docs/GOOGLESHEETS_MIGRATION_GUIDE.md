# Google Sheets マイグレーションガイド

## 📌 実装内容（2026-01-17）

### 変更概要

| 項目 | 旧構成 | 新構成 |
|---|---|---|
| **シート1** | シート1 | `記事一覧` |
| **シート2** | シート2 | `記事テーマ` |
| **シート3** | なし | `アフィリエイト管理`（新規） |
| **アフィリエイト管理** | 別スプレッドシート | シート3に統合 |

---

## 📊 各シートの詳細

### シート1: 記事一覧

生成された記事を記録・管理するシート。

**主要カラム:**
- A: タイムスタンプ
- B: ステータス（下書き / 承認済み / 投稿済み）
- C: 記事タイトル
- D: 記事ID（WordPress投稿ID）
- E: 公開URL
- F: 記事の分類（テンプレートタイプ）
- G: ターゲット
- H: タグ
- I: ディスクリプション
- J: スラッグ
- K: 使用アフィリエイト商品（prod_001, prod_003等）
- L: CVR
- M: 投稿予定日時

**用途:**
- 記事生成後に自動追記
- 記事の進捗管理
- アフィリエイト成績追跡

---

### シート2: 記事テーマ

**毎日の記事生成入力シート。ユーザーがここに記入すると自動生成。**

**主要カラム:**
- A: タイムスタンプ（自動生成）
- B: ステータス（新規 / 下書き / 承認済み / 投稿済み）
- C: 記事テーマ（例: 「Naturecan（ネイチャーカン）について」）
- D: 記事の分類（10種類から選択）
- E: ターゲット（例: CBD初心者）
- F: タグ（カンマ区切り）
- G: ディスクリプション（自動生成）
- H: スラッグ（自動生成）
- I: 使用アフィリエイト（prod_001, prod_003等）

**記事の分類（10種類）:**
1. `商品紹介` → テンプレート1
2. `初心者ガイド` → テンプレート2
3. `悩み解決` → テンプレート3
4. `経済・ビジネス` → テンプレート4
5. `製品比較` → テンプレート5
6. `成分・科学` → テンプレート6
7. `体験談・ライフスタイル` → テンプレート7
8. `トレンド・ニュース` → テンプレート8
9. `属性別` → テンプレート9
10. `購入ガイド・コスパ` → テンプレート10

**フロー:**
```
ユーザーが記事テーマを入力（B~I列）
       ↓
毎朝8:00に自動実行
       ↓
Gemini APIで記事生成
       ↓
WordPressに下書き投稿
       ↓
シート1に自動追記
シート3に使用アフィリエイトを反映
       ↓
LINE通知でプレビュー送信
```

---

### シート3: アフィリエイト管理（新規・★重要）

**商品ごとにアフィリエイトリンクを一元管理。複数の記事で再利用可能。**

#### データ構成

**主要カラム:**
- A: 商品ID（prod_001, prod_002等）
- B: 商品名（Naturecan CBDオイル 10%）
- C: ブランド（Naturecan）
- D: カテゴリ（CBDオイル / CBDグミ / CBDカプセル等）
- E: 価格（JPY）
- F: 総CBD量（mg）
- G: 1mg単価（自動計算: E/F）
- H: アフィリエイトURL
- I: ボタンテキスト
- J: 商品画像URL
- K: **使用記事ID**（1174, 1175, 1180等）
- L: **使用記事タイトル**（記事タイトル一覧）
- M: **使用記事数**（自動計算: K列のカウント）
- N: CV数（月次）
- O: 経由売上（月次）
- P: 備考

#### データ入力例

```
商品ID | 商品名 | ブランド | カテゴリ | 価格 | 総CBD量 | 1mg単価 | アフィリエイトURL | ボタンテキスト | 使用記事ID | ...
prod_001 | Naturecan CBDオイル 10% | Naturecan | CBDオイル | 8000 | 1000 | 8.0 | https://px.a8.net/... | 公式で詳細を見る | 1174,1175 | ...
prod_002 | roun CBN＋CBDドロップ | roun | CBDオイル | 5400 | 500 | 10.8 | https://px.a8.net/... | 公式で在庫を見る | 1180 | ...
```

---

## 🔄 シート間の連携フロー

### 記事生成時の自動処理

```
【毎朝8:00】
シート2（記事テーマ）から新規行を読込
       ↓
Gemini APIでHTML記事生成
       ↓
WordPressに下書き投稿（記事ID取得）
       ↓
シート1に自動追記:
  - 記事ID（D列）
  - 公開URL（E列）
  - 使用アフィリエイト（K列）など
       ↓
シート3に自動反映:
  - K列（使用記事ID）に記事IDを追記
  - L列（使用記事タイトル）を更新
  - M列（使用記事数）を再計算
       ↓
LINE通知でプレビュー送信
```

### アフィリエイト成績追跡

```
【月末】
ASP（A8.net等）から月次レポート取得
       ↓
シート3の以下を手動/自動で更新:
  - N列（CV数）
  - O列（経由売上）
       ↓
商品ごとの成績が可視化
「成績の良い商品」を優先的に次の記事で使用
       ↓
記事テーマ策定時にシート3を参考に
```

---

## 💻 コード修正リスト

### 1. `automation/content/article_generator_html.py`

**修正内容:**
- シート名: `'シート2'` → `'記事テーマ'`
- ログ出力を更新

**修正箇所:**
```python
# Line 22
ARTICLE_SHEET_NAME = '記事テーマ'  # 旧: シート2
```

**状態:** ✅ 完了

---

### 2. `docs/article/ARTICLE_CREATION_SPECIFICATION.md`

**修正内容:**
- シート1, 2, 3の新名称を反映
- アフィリエイト管理をシート3に統合
- フロー図を更新

**状態:** ✅ 完了

---

### 3. `automation/content/wordpress_publisher.py`

**確認:**
- スプレッドシート処理に問題がないか確認
- 修正不要（可能性高）

**状態:** ⏳ 確認予定

---

### 4. `automation/scripts/setup_article_sheet.py`

**修正内容:**
- シート名を `'記事テーマ'` に更新
- ヘッダー行を新構成に合わせる

**修正例:**
```python
# シート2 → 記事テーマ に変更
sheet_name = '記事テーマ'

# ヘッダー行（I列まで）
headers = [
    "タイムスタンプ", "ステータス", "記事テーマ", "記事の分類", "ターゲット",
    "タグ", "ディスクリプション", "スラッグ", "使用アフィリエイト"
]
```

**状態:** ⏳ 修正予定

---

## 🛠️ Google Sheets 手動作業（ユーザー対応）

### 1. シート名の変更

**現在:** シート1, シート2  
**新規:** 記事一覧, 記事テーマ

**手順:**
1. Google Sheets を開く
2. シート1タブ右クリック → 「名前を変更」
3. `記事一覧` に変更
4. シート2タブ右クリック → 「名前を変更」
5. `記事テーマ` に変更

### 2. シート3（アフィリエイト管理）の作成

**手順:**
1. スプレッドシート右下の「+」ボタンをクリック
2. 新しいシートを作成
3. シート3タブ右クリック → 「名前を変更」
4. `アフィリエイト管理` に変更
5. 以下のヘッダーを設定（A1～P1）:
   ```
   商品ID | 商品名 | ブランド | カテゴリ | 価格 | 総CBD量 | 1mg単価 | 
   アフィリエイトURL | ボタンテキスト | 商品画像URL | 使用記事ID | 
   使用記事タイトル | 使用記事数 | CV数（月） | 経由売上（月） | 備考
   ```

### 3. 既存アフィリエイトリンクの移行

**別スプレッドシート → シート3 へ統合**

既存の以下URLの商品データをコピー:
- `https://docs.google.com/spreadsheets/d/1vRrHmqF04QPhpuZY0wdFO8vvwj4AIBatHGEZ5zVBi7g/edit?gid=0#gid=0`

**移行手順:**
1. 既存スプレッドシートから商品情報を複製
2. シート3（アフィリエイト管理）に貼り付け
3. 商品ID（prod_001等）を付与
4. K列（使用記事ID）は後から自動入力

---

## ✅ 実装チェックリスト

### Google Sheets 側

- [ ] シート1 を `記事一覧` に名前変更
- [ ] シート2 を `記事テーマ` に名前変更
- [ ] シート3 を作成して `アフィリエイト管理` に命名
- [ ] シート3 にヘッダー行を設定
- [ ] 既存アフィリエイトリンクをシート3に統合

### コード側

- [ ] `article_generator_html.py` のシート名を更新
- [ ] `setup_article_sheet.py` のシート名を更新
- [ ] その他スクリプトでシート名参照箇所を確認・更新
- [ ] ドキュメント（ARTICLE_CREATION_SPECIFICATION.md）を更新

### テスト

- [ ] 新しい記事テーマをシート2に入力
- [ ] 8:00に自動生成されるか確認
- [ ] シート1に自動追記されるか確認
- [ ] シート3の「使用記事ID」が更新されるか確認
- [ ] LINE通知で正常にプレビューが送信されるか確認

---

## 📝 注意事項

### 1. シート名の大文字・小文字

- Google Sheets のシート名は **大文字小文字を区別** しません
- しかし Python の `read_spreadsheet` は **完全一致** で処理
- スペース、全角・半角にも注意

### 2. 既存データの保持

- 旧シート1、シート2のデータは削除しないこと
- 必要に応じてバックアップを作成

### 3. アフィリエイト商品ID の一貫性

- 商品ID（prod_001等）は統一的に管理
- 記事テーマのI列で参照
- 複数商品を使う場合はカンマ区切り（例: `prod_001,prod_003`）

---

## 🔗 関連ドキュメント

- `ARTICLE_GOOGLESHEETS_STRUCTURE.md` - シート構成の詳細
- `ARTICLE_CREATION_SPECIFICATION.md` - 記事作成要件
- `ARTICLE_TEMPLATES_PROPOSAL_PART2.md` - テンプレート10種類

---

**実装日:** 2026-01-17  
**対象:** CBD自動記事生成システム
