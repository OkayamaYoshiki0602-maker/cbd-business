# 動画アフィリエイトツイートの完全フロー

## 📋 概要

動画アフィリエイトリンクを含むツイートを投稿するまでの完全な流れと、必要な準備を説明します。

---

## 🔄 ツイート投稿の流れ（自動化後）

### ステップ1: 商品情報の取得

```
DMM API → 商品検索 → 商品情報を取得
```

**取得する情報**:
- タイトル
- 女優名
- 発売日
- サンプル画像URL
- アフィリエイトリンク

**実装**: `dmm_affiliate.py` の `search_products()` または `get_product_by_content_id()`

---

### ステップ2: サンプル画像のダウンロード

```
サンプル画像URL → 画像ダウンロード → ローカルに保存
```

**実装**: `dmm_affiliate.py` の `download_sample_image()`

**保存先**: `./temp_images/[content_id].jpg`

---

### ステップ3: ツイート文案の生成

```
商品情報 → テンプレート適用 → ツイート文案
```

**テンプレート例**:
```
【作品タイトル】
女優: [女優名]
発売日: [発売日]

[30-50文字の紹介文]

詳細・購入⇩
[アフィリエイトリンク]
#AV #エロ動画 #R18 🔞
```

**実装**: `adult_twitter_generator.py` の `generate_video_tweet()`

---

### ステップ4: Twitter投稿

```
ツイート文案 + 画像 → Twitter API → 投稿完了
```

**実装**: `x_twitter.py` の `upload_media()` と `tweet()`

**流れ**:
1. 画像をアップロード → メディアID取得
2. ツイート投稿（テキスト + メディアID）

---

## 🛠️ 申請完了までの準備（今すぐできること）

### 1. Twitterアカウント設定 ✅

**@otonasan_review のプロフィール設定**

- [ ] **表示名**: `新作AV情報🔞 | 18歳未満閲覧禁止`
- [ ] **プロフィール説明**: 
  ```
  🔞 18歳未満の方の閲覧・フォローはご遠慮ください
  
  📹 新作AV情報を発信
  💬 人気作品・おすすめ作品を紹介
  🎯 最新情報をいち早くお届け
  
  #AV #エロ動画 #R18
  
  ※アフィリエイトリンクを含みます
  ```
- [ ] **プロフィール画像**: 控えめなアイコン（R18表記など）
- [ ] **ピン留めツイート**: 18歳未満閲覧禁止の注意書き

---

### 2. 環境変数の準備 ✅

**.envファイルの確認・準備**

```env
# DMM API認証情報（申請承認後に取得）
DMM_API_ID=（申請承認後に設定）
DMM_AFFILIATE_ID=（申請承認後に設定）

# Twitter API認証情報（@otonasan_review用）
X_API_KEY=（既に設定済み？）
X_API_SECRET_KEY=（既に設定済み？）
X_ACCESS_TOKEN=（既に設定済み？）
X_ACCESS_TOKEN_SECRET=（既に設定済み？）
X_BEARER_TOKEN=（既に設定済み？）
```

**確認事項**:
- [ ] Twitter API認証情報が既に設定されているか確認
- [ ] 設定されていない場合は、Twitter Developer Portalで取得
- [ ] DMM API認証情報は申請承認後に設定

---

### 3. 依存ライブラリのインストール ✅

```bash
cd automation
pip install -r requirements.txt
```

**新規追加が必要なライブラリ**:
- `dmm-search3>=2.0.0`

**確認**:
```bash
pip list | grep dmm-search3
```

---

### 4. ディレクトリ構造の準備 ✅

```bash
# 画像保存用ディレクトリ
mkdir -p temp_images
mkdir -p dmm_images

# ログ用ディレクトリ（必要に応じて）
mkdir -p logs
```

---

### 5. テスト用商品リストの準備 ✅

**GoogleスプレッドシートまたはCSVファイルで管理**

| content_id | title | 女優 | 発売日 | 投稿予定日 | ステータス |
|------------|-------|------|--------|------------|------------|
| d_xxxxxx | 作品タイトル | 女優名 | 2025/02/01 | 2025/02/01 | 未投稿 |
| d_yyyyyy | 作品タイトル | 女優名 | 2025/02/02 | 2025/02/02 | 未投稿 |

**用途**:
- 投稿予定の商品を管理
- 投稿履歴を記録
- 重複投稿を防止

---

### 6. ツイートテンプレートの作成 ✅

**基本テンプレート**

```python
# テンプレート例
VIDEO_TWEET_TEMPLATE = """
【{title}】
女優: {actress}
発売日: {release_date}

{description}

詳細・購入⇩
{affiliate_url}
#AV #エロ動画 #R18 🔞
"""
```

**バリエーション作成**:
- 新作紹介用
- 人気作品紹介用
- セール情報用

---

### 7. スケジュール投稿の設計 ✅

**投稿頻度の決定**:
- 平日: 2回/日（13:00, 20:00など）
- 休日: 3回/日（11:00, 15:00, 21:00など）

**実装方法**:
- 既存の `scheduled_tweet.py` を拡張
- または `schedule` ライブラリを使用

---

### 8. 漫画アカウントの準備 ✅

**次のステップとして**:
- [ ] 漫画用Twitterアカウント名を決定
- [ ] Twitterアカウント作成
- [ ] プロフィール設定
- [ ] DMMサイト追加申請（動画アカウント承認後に）

---

## 📝 申請承認後の作業フロー

### ステップ1: API認証情報の設定

```bash
# .envファイルに追加
DMM_API_ID=[取得したAPI ID]
DMM_AFFILIATE_ID=[取得したアフィリエイトID]
```

---

### ステップ2: 動作確認

```bash
# DMM API接続テスト
python automation/social_media/dmm_affiliate.py search AV

# ツイート生成テスト（dry-run）
python automation/social_media/adult_twitter_generator.py video \
  --search AV \
  --count 3 \
  --dry-run
```

---

### ステップ3: テスト投稿

```bash
# 実際に1件投稿（テスト）
python automation/social_media/adult_twitter_generator.py video \
  --content-id d_xxxxxx
```

---

### ステップ4: 本格運用開始

- スケジュール投稿の設定
- スプレッドシートでの管理
- 定期的な最適化

---

## 🎯 今すぐやるべきこと（優先順位）

### 最優先（今すぐ）

1. ✅ **Twitterアカウント設定**
   - @otonasan_review のプロフィール完成

2. ✅ **環境変数の確認**
   - Twitter API認証情報の確認・設定

3. ✅ **ライブラリのインストール**
   - `pip install dmm-search3`

### 優先度高（今日中）

4. ✅ **ディレクトリ準備**
   - `temp_images/` 等の作成

5. ✅ **テスト用商品リスト作成**
   - スプレッドシートまたはCSV

6. ✅ **ツイートテンプレート設計**
   - 複数のバリエーションを作成

### 優先度中（申請承認待ちの間に）

7. ✅ **スケジュール投稿の設計**
   - 投稿頻度・時間の決定

8. ✅ **漫画アカウントの準備**
   - アカウント名決定、作成

---

## 📊 チェックリスト

### 申請承認まで（2日間）

- [ ] Twitterアカウント @otonasan_review のプロフィール設定完了
- [ ] Twitter API認証情報の確認・設定
- [ ] 依存ライブラリインストール済み
- [ ] ディレクトリ構造準備済み
- [ ] テスト用商品リスト作成済み
- [ ] ツイートテンプレート設計完了
- [ ] スケジュール投稿の設計完了
- [ ] 漫画アカウント名決定

### 申請承認後

- [ ] DMM API認証情報を.envに設定
- [ ] DMM API接続テスト成功
- [ ] ツイート生成テスト（dry-run）成功
- [ ] テスト投稿成功
- [ ] 本格運用開始

---

**作成日**: 2025-01-30
