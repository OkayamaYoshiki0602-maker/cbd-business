# Google Sheets構造設定書

## 📊 基本構成（3シート統一管理）

**スプレッドシートID:** `1-2L6C3NpF8vqnXxHWKP-Js3TMFKYE73tTtxdkZVPTaM`

### シート構成

| シート名 | 旧名称 | 目的 | 主要カラム |
|---|---|---|---|
| **記事テーマ** | シート2 | 記事生成の入力 | ステータス、タイトル、分類、ターゲット、タグ等 |
| **記事一覧** | シート1 | 生成された記事の管理 | WordPress ID、タイトル、公開状態、作成日等 |
| **アフィリエイト管理** | 新規 | 商品ごとのリンク管理 | 商品名、URL、使用記事、管理情報等 |

---

## 📋 シート1: 記事一覧（旧シート1）

### 目的
生成されたすべての記事を一覧で管理。記事の状態追跡とメタデータ管理。

### カラム設定

| 列 | 列名 | 説明 | 例 |
|---|---|---|---|
| A | タイムスタンプ | 記事生成日時 | 2026-01-17T08:00:00 |
| B | ステータス | 記事の状態 | 下書き / 承認済み / 投稿済み |
| C | 記事タイトル | 記事のタイトル | 【決定版】Naturecan(ネイチャーカン)の評判は？ |
| D | 記事ID | WordPress投稿ID | 1174 |
| E | 公開URL | 記事の公開URL | https://cbd-no-hito.com/?p=1174 |
| F | 記事の分類 | テンプレートタイプ | 商品紹介 / 初心者ガイド等 |
| G | ターゲット | 対象ユーザー | CBD初心者 / ストレス対策したい方 |
| H | タグ | 記事に付与したタグ | CBD,初心者,おすすめ,安心 |
| I | ディスクリプション | メタディスクリプション | CBD初心者向けの安心ガイド... |
| J | スラッグ | 記事のスラッグ | cbd-beginners-guide-2026 |
| K | 使用アフィリエイト商品 | リンク使用の商品ID | prod_001,prod_003 |
| L | CVR | コンバージョン率（計測用） | 2.5% |
| M | 投稿予定日時 | 自動投稿の時刻 | 2026-01-17 13:00 |

### データ入力例

```
タイムスタンプ | ステータス | 記事タイトル | 記事ID | 公開URL | 記事の分類 | ターゲット | タグ | ...
2026-01-17T08:00 | 投稿済み | 【決定版】Naturecan... | 1174 | https://cbd-no-hito.com/?p=1174 | 商品紹介 | CBD初心者 | CBD,初心者,おすすめ | ...
```

---

## 📝 シート2: 記事テーマ（旧シート2）

### 目的
記事生成のための入力データ管理。毎日のテーマを登録し、自動で記事が生成される。

### カラム設定

| 列 | 列名 | 説明 | 例 | 必須 |
|---|---|---|---|---|
| A | タイムスタンプ | 行作成日時 | 2026-01-17T08:00:00 | 自動 |
| B | ステータス | 処理状況 | 新規 / 下書き / 承認済み / 投稿済み | ✓ |
| C | 記事テーマ | 記事のメインテーマ | 「Naturecan（ネイチャーカン）について」 | ✓ |
| D | 記事の分類 | テンプレートタイプ | 商品紹介 / 初心者ガイド / 悩み解決 / 経済・ビジネス / 製品比較 / 成分・科学 / 体験談・ライフスタイル / トレンド・ニュース / 属性別 / 購入ガイド・コスパ | ✓ |
| E | ターゲット | 対象ユーザー | CBD初心者 / ストレス対策したい方 / シニア世代 | ✓ |
| F | タグ | 記事に付与するタグ（カンマ区切り） | CBD,初心者,おすすめ,安心 | ✓ |
| G | ディスクリプション | メタディスクリプション（自動生成） | 記事の要約 | 自動 |
| H | スラッグ | 記事スラッグ（自動生成） | cbd-beginners-guide-2026 | 自動 |
| I | 使用アフィリエイト | 記事内で使う商品ID（カンマ区切り） | prod_001,prod_003 | 任意 |

### データ入力例（新規行）

```
タイムスタンプ | ステータス | 記事テーマ | 記事の分類 | ターゲット | タグ | ...
（自動） | 新規 | Naturecan(ネイチャーカン)について | 商品紹介 | CBD初心者 | CBD,初心者,おすすめ | ...
```

### ステータスの流れ

```
新規 → 下書き（記事生成）→ 承認済み（ユーザーが確認後）→ 投稿済み（自動公開）
```

---

## 💰 シート3: アフィリエイト管理（新規 - ★重要）

### 目的
すべてのアフィリエイト商品を**商品ごと**に一元管理。
記事ごとではなく、商品ごとに管理することで、複数記事で同じ商品を再利用可能。

### カラム設定

| 列 | 列名 | 説明 | 例 | 必須 |
|---|---|---|---|---|
| A | 商品ID | 商品の一意識別子 | prod_001 | ✓ |
| B | 商品名 | 商品の正式名称 | Naturecan CBDオイル 10% | ✓ |
| C | ブランド | ブランド名 | Naturecan | ✓ |
| D | カテゴリ | 製品カテゴリ | CBDオイル / CBDグミ / CBDカプセル / CBDベイプ | ✓ |
| E | 価格 | 商品価格（JPY） | 8000 | ✓ |
| F | 総CBD量 | CBD含有量（mg） | 1000 | ✓ |
| G | 1mg単価 | コスパ計算用 | 8.0 | 自動計算 |
| H | アフィリエイトURL | A8.net等のアフィリエイトリンク | https://px.a8.net/svt/ejp?... | ✓ |
| I | ボタンテキスト | リンクボタンに表示するテキスト | 公式で詳細・成分表を見る（Naturecan） | ✓ |
| J | 商品画像URL | 商品の画像（WordPress メディアライブラリURL推奨） | https://cdn.example.com/prod_001.jpg | 任意 |
| K | 使用記事ID | この商品を使用している記事のID（カンマ区切り） | 1174,1175,1180 | 自動更新 |
| L | 使用記事タイトル | 使用記事のタイトル | 【決定版】Naturecan..., CBD初心者ガイド | 自動更新 |
| M | 使用記事数 | 何件の記事で使用されているか | 3 | 自動計算 |
| N | CV数（月） | 月間コンバージョン数 | 5 | 計測用 |
| O | 経由売上（月） | この商品経由の売上 | ¥50,000 | 計測用 |
| P | 備考 | 管理メモ | セール中 / 在庫注意 等 | 任意 |

### データ入力例

```
商品ID | 商品名 | ブランド | カテゴリ | 価格 | 総CBD量 | 1mg単価 | アフィリエイトURL | ボタンテキスト | ...
prod_001 | Naturecan CBDオイル 10% | Naturecan | CBDオイル | 8000 | 1000 | 8.0 | https://px.a8.net/... | 公式で詳細・成分表を見る（Naturecan） | ...
prod_002 | roun CBN＋CBDドロップ | roun | CBDオイル | 5400 | 500 | 10.8 | https://px.a8.net/... | 公式で在庫を見る（roun） | ...
```

### 商品と記事の紐付け方法

**シート2（記事テーマ）の「I列（使用アフィリエイト）」で商品IDを指定：**

```
例：
記事テーマ「Naturecan評判」
使用アフィリエイト → "prod_001,prod_003"
       ↓
この記事が生成されると、自動的に
シート3のK列「使用記事ID」に記事ID（1174等）が追記される
       ↓
シート3の「L列」「M列」が自動で更新される
```

---

## 🔄 シート間の連携フロー

### 1. 記事生成フロー

```
記事テーマを入力（シート2）
       ↓
Gemini APIで記事生成
       ↓
WordPressに下書き投稿（記事ID取得）
       ↓
シート1に記事情報を自動反映
シート3に記事IDを自動追記（使用アフィリエイト指定時）
```

### 2. アフィリエイト成績追跡フロー

```
アフィリエイトASP（A8.net等）から月次レポート取得
       ↓
シート3の「N列（CV数）」「O列（経由売上）」を手動または自動で更新
       ↓
商品の成績と、どの記事経由かを可視化
       ↓
次の記事生成時に「成績の良い商品」を優先的に選択
```

---

## 📊 使用シーン別の活用

### シーン1: 新しい記事テーマを登録

1. シート2に行を追加
2. 「記事テーマ」「分類」「ターゲット」「タグ」を入力
3. 「使用アフィリエイト」で使いたい商品ID（prod_001等）をカンマ区切りで入力
4. ステータスを「新規」に設定
5. 毎朝8:00に自動生成される

### シーン2: 既存商品を新しい記事で紹介

1. シート3で既存商品を確認（例：prod_001）
2. 新しい記事テーマをシート2に作成
3. 「使用アフィリエイト」に「prod_001」を入力
4. 記事生成後、シート3のK列に自動追記される

### シーン3: アフィリエイト成績を分析

1. シート3を見る
2. 「M列（使用記事数）」と「O列（経由売上）」で商品ごとの成績を確認
3. 成績の良い商品を優先的に次の記事で紹介する

---

## 🔧 自動化の実装

### コード修正が必要な箇所

#### `article_generator_html.py`
- **行22:** `ARTICLE_SHEET_NAME = 'シート2'` → `ARTICLE_SHEET_NAME = '記事テーマ'`
- **修正箇所:** スプレッドシート読み込み時にシート名を使用

#### `automation/google_services/google_sheets.py`
- **確認:** シート名を正確に読み込んでいるか確認
- **修正不要（可能性高）**

#### `docs/article/ARTICLE_CREATION_SPECIFICATION.md`
- **更新:** シート名、カラム構成を最新に更新
- **追加:** アフィリエイト管理シートの説明

---

## 📌 シート名の最終確認

| 旧名称 | 新名称 | URL（参考） |
|---|---|---|
| シート1 | **記事一覧** | gid=0 |
| シート2 | **記事テーマ** | gid=534297966 |
| （新規） | **アフィリエイト管理** | （未作成） |

**スプレッドシートURL:** https://docs.google.com/spreadsheets/d/1-2L6C3NpF8vqnXxHWKP-Js3TMFKYE73tTtxdkZVPTaM/

---

## ✅ 実装チェックリスト

- [ ] Google Sheets で 3つのシートを作成・リネーム
- [ ] シート3（アフィリエイト管理）の構造を設定
- [ ] `article_generator_html.py` のシート名を更新
- [ ] 既存アフィリエイトリンクをシート3に集約
- [ ] テスト記事生成で紐付けが正確に機能するか確認
- [ ] `ARTICLE_CREATION_SPECIFICATION.md` を更新

---

**作成日:** 2026-01-17  
**対象:** CBD自動記事生成システム
